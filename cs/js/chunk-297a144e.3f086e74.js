(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-297a144e"],{"08db":function(e,t,s){"use strict";s("7cf1")},"7cf1":function(e,t,s){},ffef:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"file-manager-page page-container"},[t("div",{staticClass:"page-header"},[e._m(0),t("div",{staticClass:"header-actions"},[t("el-upload",{ref:"upload",attrs:{action:"/api/bin/upload","show-file-list":!1,"on-success":e.onUploadSuccess,"on-error":e.onUploadError,accept:".bin"}},[t("el-button",{attrs:{type:"primary",icon:"el-icon-upload"}},[e._v("上传文件")])],1)],1)]),t("el-tabs",{staticClass:"file-tabs",model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[t("el-tab-pane",{attrs:{label:"参数文件",name:"files"}},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading.files,expression:"loading.files"}],staticClass:"file-grid"},[e._l(e.fileList,(function(s){return t("div",{key:s.name,staticClass:"file-card",class:{selected:e.selectedFiles.includes(s.name)}},[t("div",{staticClass:"file-checkbox"},[t("el-checkbox",{attrs:{value:e.selectedFiles.includes(s.name)},on:{change:function(t){return e.toggleSelect(s.name)}}})],1),t("div",{staticClass:"file-icon"},[t("i",{staticClass:"el-icon-document"})]),t("div",{staticClass:"file-info"},[t("h4",{staticClass:"file-name",attrs:{title:s.name}},[e._v(e._s(s.name))]),t("div",{staticClass:"file-meta"},[t("span",{staticClass:"file-size"},[e._v(e._s(e.formatSize(s.size)))]),t("span",{staticClass:"file-date"},[e._v(e._s(e.formatDate(s.modified)))])])]),t("div",{staticClass:"file-actions"},[t("el-tooltip",{attrs:{content:"编辑参数",placement:"top"}},[t("el-button",{attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(t){return e.editFile(s.name)}}})],1),t("el-tooltip",{attrs:{content:"下载",placement:"top"}},[t("el-button",{attrs:{type:"text",icon:"el-icon-download"},on:{click:function(t){return e.downloadFile(s.name)}}})],1),t("el-dropdown",{attrs:{trigger:"click"},on:{command:function(t){return e.handleFileCommand(t,s.name)}}},[t("el-button",{attrs:{type:"text",icon:"el-icon-more"}}),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"rename",icon:"el-icon-edit-outline"}},[e._v("重命名")]),t("el-dropdown-item",{attrs:{command:"duplicate",icon:"el-icon-document-copy"}},[e._v("复制")]),t("el-dropdown-item",{attrs:{command:"delete",icon:"el-icon-delete",divided:""}},[e._v("删除")])],1)],1)],1)])})),0===e.fileList.length?t("div",{staticClass:"empty-state"},[t("i",{staticClass:"el-icon-folder-add"}),t("p",[e._v("暂无参数文件")]),t("p",{staticClass:"empty-hint"},[e._v("上传.bin文件或从设备同步")])]):e._e()],2),e.selectedFiles.length>0?t("div",{staticClass:"batch-actions"},[t("span",{staticClass:"selected-count"},[e._v("已选择 "+e._s(e.selectedFiles.length)+" 个文件")]),t("el-button",{attrs:{size:"small"},on:{click:function(t){e.selectedFiles=[]}}},[e._v("取消选择")]),t("el-button",{attrs:{size:"small",type:"danger"},on:{click:e.batchDelete}},[e._v("批量删除")])],1):e._e()]),t("el-tab-pane",{attrs:{label:"备份文件",name:"backups"}},[t("div",{staticClass:"backup-list"},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.backupList,"empty-text":"暂无备份"}},[t("el-table-column",{attrs:{prop:"name",label:"文件名","min-width":"200"},scopedSlots:e._u([{key:"default",fn:function({row:s}){return[t("i",{staticClass:"el-icon-time",staticStyle:{color:"var(--text-muted)","margin-right":"8px"}}),e._v(" "+e._s(s.name)+" ")]}}])}),t("el-table-column",{attrs:{prop:"size",label:"大小",width:"100"},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(e.formatSize(t.size))+" ")]}}])}),t("el-table-column",{attrs:{prop:"created",label:"创建时间",width:"180"},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(e.formatDate(t.created))+" ")]}}])}),t("el-table-column",{attrs:{label:"操作",width:"150",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function({row:s}){return[t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.restoreBackup(s.name)}}},[e._v(" 恢复 ")]),t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.downloadBackup(s.name)}}},[e._v(" 下载 ")])]}}])})],1)],1)])],1)],1)},i=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"header-left"},[t("h1",{staticClass:"page-title"},[e._v("文件管理")]),t("p",{staticClass:"page-subtitle"},[e._v("管理本地bin参数文件与备份")])])}],l=(s("14d9"),s("2f62")),n=s("365c"),c={name:"FileManager",data(){return{activeTab:"files",selectedFiles:[]}},computed:{...Object(l["c"])(["fileList","backupList","loading"])},mounted(){this.$store.dispatch("loadFileList"),this.$store.dispatch("loadBackupList")},methods:{formatSize(e){return e?e<1024?e+" B":e<1048576?(e/1024).toFixed(1)+" KB":(e/1048576).toFixed(1)+" MB":"0 B"},formatDate(e){return e?new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"},toggleSelect(e){const t=this.selectedFiles.indexOf(e);-1===t?this.selectedFiles.push(e):this.selectedFiles.splice(t,1)},editFile(e){this.$store.dispatch("openFile",e).then(e=>{e.success?this.$router.push("/params"):this.$message.error(e.error||"打开文件失败")})},downloadFile(e){const t=document.createElement("a");t.href="/api/bin/download/"+encodeURIComponent(e),t.download=e,t.click()},downloadBackup(e){const t=document.createElement("a");t.href="/api/bin/backup/download/"+encodeURIComponent(e),t.download=e,t.click()},async handleFileCommand(e,t){switch(e){case"rename":this.renameFile(t);break;case"duplicate":this.duplicateFile(t);break;case"delete":this.deleteFile(t);break}},async renameFile(e){try{const{value:t}=await this.$prompt("请输入新文件名","重命名",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:e,inputPattern:/^[\w.-]+\.bin$/,inputErrorMessage:"文件名格式不正确"});t&&t!==e&&(this.$message.success("重命名成功"),this.$store.dispatch("loadFileList"))}catch{}},async duplicateFile(e){const t=e.replace(".bin","_copy.bin");this.$message.success("文件已复制为 "+t),this.$store.dispatch("loadFileList")},async deleteFile(e){try{await this.$confirm(`确定要删除文件 "${e}" 吗？`,"删除确认",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}),this.$message.success("文件已删除"),this.$store.dispatch("loadFileList")}catch{}},async batchDelete(){try{await this.$confirm(`确定要删除选中的 ${this.selectedFiles.length} 个文件吗？`,"批量删除",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}),this.$message.success("文件已删除"),this.selectedFiles=[],this.$store.dispatch("loadFileList")}catch{}},async restoreBackup(e){try{const{value:t}=await this.$prompt("请输入恢复后的文件名","恢复备份",{confirmButtonText:"恢复",cancelButtonText:"取消",inputValue:e.split("_").slice(1).join("_")});t&&(await n["a"].bin.restore(e,t),this.$message.success("备份恢复成功"),this.$store.dispatch("loadFileList"))}catch{}},onUploadSuccess(e){e.success?(this.$message.success("文件上传成功"),this.$store.dispatch("loadFileList")):this.$message.error(e.error||"上传失败")},onUploadError(e){this.$message.error("上传失败: "+e.message)}}},o=c,r=(s("08db"),s("2877")),d=Object(r["a"])(o,a,i,!1,null,"19b5cff9",null);t["default"]=d.exports}}]);