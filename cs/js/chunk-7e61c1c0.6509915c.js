(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7e61c1c0"],{"0670":function(s,t,e){"use strict";e.r(t);var i=function(){var s,t,e,i=this,c=i._self._c;return c("div",{staticClass:"device-page page-container"},[i._m(0),c("div",{staticClass:"device-layout"},[c("div",{staticClass:"card connection-card"},[c("div",{staticClass:"card-header"},[c("h3",{staticClass:"card-title"},[i._v("连接配置")]),c("div",{staticClass:"connection-status",class:i.deviceConnected?"connected":"disconnected"},[c("span",{staticClass:"status-dot"}),c("span",[i._v(i._s(i.deviceConnected?"已连接":"未连接"))])])]),c("div",{staticClass:"connection-form"},[c("div",{staticClass:"form-row"},[c("label",[i._v("设备 IP 地址")]),c("el-input",{attrs:{placeholder:"例如: 192.168.1.100",disabled:i.deviceConnected},model:{value:i.connectForm.ip,callback:function(s){i.$set(i.connectForm,"ip",s)},expression:"connectForm.ip"}},[c("template",{slot:"prepend"},[c("i",{staticClass:"el-icon-location"})])],2)],1),c("div",{staticClass:"form-row"},[c("label",[i._v("UDP 端口")]),c("el-input-number",{attrs:{min:1,max:65535,disabled:i.deviceConnected,"controls-position":"right"},model:{value:i.connectForm.port,callback:function(s){i.$set(i.connectForm,"port",s)},expression:"connectForm.port"}})],1),c("div",{staticClass:"form-actions"},[i.deviceConnected?c("el-button",{attrs:{type:"danger",icon:"el-icon-switch-button"},on:{click:i.handleDisconnect}},[i._v(" 断开连接 ")]):c("el-button",{attrs:{type:"primary",icon:"el-icon-connection",loading:i.loading.device},on:{click:i.handleConnect}},[i._v(" 连接设备 ")]),c("el-button",{attrs:{icon:"el-icon-search",loading:i.discovering},on:{click:i.handleDiscover}},[i._v(" 扫描设备 ")])],1)])]),i.deviceConnected?c("div",{staticClass:"card device-info-card"},[i._m(1),c("div",{staticClass:"device-info"},[c("div",{staticClass:"info-row"},[c("span",{staticClass:"info-label"},[i._v("设备型号")]),c("span",{staticClass:"info-value"},[i._v(i._s((null===(s=i.device.info)||void 0===s?void 0:s.model)||"-"))])]),c("div",{staticClass:"info-row"},[c("span",{staticClass:"info-label"},[i._v("固件版本")]),c("span",{staticClass:"info-value"},[i._v(i._s((null===(t=i.device.info)||void 0===t?void 0:t.firmware)||"-"))])]),c("div",{staticClass:"info-row"},[c("span",{staticClass:"info-label"},[i._v("序列号")]),c("span",{staticClass:"info-value mono"},[i._v(i._s((null===(e=i.device.info)||void 0===e?void 0:e.serial)||"-"))])]),c("div",{staticClass:"info-row"},[c("span",{staticClass:"info-label"},[i._v("IP 地址")]),c("span",{staticClass:"info-value mono"},[i._v(i._s(i.device.ip)+":"+i._s(i.device.port))])]),c("div",{staticClass:"info-row"},[c("span",{staticClass:"info-label"},[i._v("最后心跳")]),c("span",{staticClass:"info-value"},[i._v(i._s(i.formatDate(i.device.lastHeartbeat)))])])])]):i._e(),i.discoveredDevices.length>0?c("div",{staticClass:"card discover-card"},[c("div",{staticClass:"card-header"},[c("h3",{staticClass:"card-title"},[i._v("发现的设备")]),c("el-button",{attrs:{type:"text",icon:"el-icon-close"},on:{click:function(s){i.discoveredDevices=[]}}})],1),c("div",{staticClass:"device-list"},i._l(i.discoveredDevices,(function(s){return c("div",{key:s.ip,staticClass:"device-item",on:{click:function(t){return i.selectDevice(s)}}},[i._m(2,!0),c("div",{staticClass:"device-details"},[c("span",{staticClass:"device-model"},[i._v(i._s(s.model))]),c("span",{staticClass:"device-ip"},[i._v(i._s(s.ip)+":"+i._s(s.port))])]),c("el-button",{attrs:{type:"text",icon:"el-icon-right"}})],1)})),0)]):i._e(),i.deviceConnected?c("div",{staticClass:"card actions-card"},[i._m(3),c("div",{staticClass:"action-buttons"},[c("el-button",{attrs:{loading:i.readingBin},on:{click:i.readFromDevice}},[c("i",{staticClass:"el-icon-download"}),i._v(" 读取设备参数 ")]),c("el-button",{attrs:{disabled:!i.currentFile,loading:i.loading.sync},on:{click:i.syncToDevice}},[c("i",{staticClass:"el-icon-upload2"}),i._v(" 同步参数到设备 ")]),c("el-button",{on:{click:function(s){return i.sendCommand("restart")}}},[c("i",{staticClass:"el-icon-refresh"}),i._v(" 重启设备 ")]),c("el-button",{on:{click:function(s){return i.sendCommand("get_status")}}},[c("i",{staticClass:"el-icon-info"}),i._v(" 获取状态 ")])],1)]):i._e(),c("div",{staticClass:"card log-card"},[c("div",{staticClass:"card-header"},[c("h3",{staticClass:"card-title"},[i._v("通信日志")]),c("el-button",{attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(s){i.logs=[]}}},[i._v("清空")])],1),c("div",{ref:"logContainer",staticClass:"log-content"},[i._l(i.logs,(function(s,t){return c("div",{key:t,staticClass:"log-item",class:s.type},[c("span",{staticClass:"log-time"},[i._v(i._s(s.time))]),c("span",{staticClass:"log-type"},[i._v(i._s(s.type.toUpperCase()))]),c("span",{staticClass:"log-message"},[i._v(i._s(s.message))])])})),0===i.logs.length?c("div",{staticClass:"log-empty"},[i._v(" 暂无日志 ")]):i._e()],2)])])])},c=[function(){var s=this,t=s._self._c;return t("div",{staticClass:"page-header"},[t("h1",{staticClass:"page-title"},[s._v("设备连接")]),t("p",{staticClass:"page-subtitle"},[s._v("管理与电子负载设备的连接")])])},function(){var s=this,t=s._self._c;return t("div",{staticClass:"card-header"},[t("h3",{staticClass:"card-title"},[s._v("设备信息")])])},function(){var s=this,t=s._self._c;return t("div",{staticClass:"device-icon"},[t("i",{staticClass:"el-icon-cpu"})])},function(){var s=this,t=s._self._c;return t("div",{staticClass:"card-header"},[t("h3",{staticClass:"card-title"},[s._v("设备操作")])])}],a=e("2f62"),o=e("365c"),n={name:"DeviceConnect",data(){return{connectForm:{ip:"192.168.1.100",port:8080},discovering:!1,discoveredDevices:[],readingBin:!1,logs:[]}},computed:{...Object(a["c"])(["device","currentFile","loading"]),...Object(a["b"])(["deviceConnected"])},mounted(){this.loadDefaultSettings()},methods:{async loadDefaultSettings(){try{const{data:s}=await o["a"].config.get();s.success&&s.config.device&&(this.connectForm.ip=s.config.device.defaultIp||this.connectForm.ip,this.connectForm.port=s.config.device.defaultPort||this.connectForm.port)}catch(s){}},addLog(s,t){const e=new Date,i=e.toLocaleTimeString("zh-CN",{hour12:!1});this.logs.unshift({type:s,message:t,time:i}),this.logs.length>100&&this.logs.pop()},async handleConnect(){if(!this.connectForm.ip)return void this.$message.warning("请输入设备IP地址");this.addLog("info",`正在连接 ${this.connectForm.ip}:${this.connectForm.port}...`);const s=await this.$store.dispatch("connectDevice",{ip:this.connectForm.ip,port:this.connectForm.port});s.success?(this.addLog("success","设备连接成功"),this.$message.success("设备连接成功")):(this.addLog("error","连接失败: "+s.error),this.$message.error(s.error||"连接失败"))},async handleDisconnect(){this.addLog("info","正在断开连接...");const s=await this.$store.dispatch("disconnectDevice");s.success?(this.addLog("info","已断开连接"),this.$message.info("已断开设备连接")):this.addLog("error","断开失败: "+s.error)},async handleDiscover(){this.discovering=!0,this.addLog("info","正在扫描局域网设备...");try{const s=this.connectForm.ip.split(".").slice(0,3).join("."),{data:t}=await o["a"].device.discover(s);t.success&&t.devices?(this.discoveredDevices=t.devices,this.addLog("success",`发现 ${t.devices.length} 台设备`)):this.addLog("warning","未发现设备")}catch(s){this.addLog("error","扫描失败: "+s.message)}finally{this.discovering=!1}},selectDevice(s){this.connectForm.ip=s.ip,this.connectForm.port=s.port,this.addLog("info",`已选择设备 ${s.ip}:${s.port}`)},async readFromDevice(){this.readingBin=!0,this.addLog("info","正在从设备读取参数...");try{const{data:s}=await o["a"].device.readBin();s.success?(this.addLog("success","参数读取成功"),this.$message.success("参数读取成功")):this.addLog("error","读取失败: "+s.error)}catch(s){this.addLog("error","读取失败: "+s.message)}finally{this.readingBin=!1}},async syncToDevice(){this.addLog("info","正在同步参数到设备...");const s=await this.$store.dispatch("syncToDevice");s.success?this.addLog("success","参数同步成功"):this.addLog("error","同步失败: "+s.error)},async sendCommand(s){this.addLog("info","发送命令: "+s);try{const{data:t}=await o["a"].device.command(s,{});t.success?this.addLog("success","命令响应: "+(t.response||"OK")):this.addLog("error","命令失败: "+t.error)}catch(t){this.addLog("error","命令失败: "+t.message)}},formatDate(s){return s?new Date(s).toLocaleString("zh-CN"):"-"}}},d=n,r=(e("11f0"),e("2877")),l=Object(r["a"])(d,i,c,!1,null,"0372bc0e",null);t["default"]=l.exports},"11f0":function(s,t,e){"use strict";e("6314")},6314:function(s,t,e){}}]);