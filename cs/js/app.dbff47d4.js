(function(e){function t(t){for(var n,o,a=t[0],c=t[1],l=t[2],u=0,h=[];u<a.length;u++)o=a[u],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&h.push(i[o][0]),i[o]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);d&&d(t);while(h.length)h.shift()();return r.push.apply(r,l||[]),s()}function s(){for(var e,t=0;t<r.length;t++){for(var s=r[t],n=!0,a=1;a<s.length;a++){var c=s[a];0!==i[c]&&(n=!1)}n&&(r.splice(t--,1),e=o(o.s=s[0]))}return e}var n={},i={app:0},r=[];function o(t){if(n[t])return n[t].exports;var s=n[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=e,o.c=n,o.d=function(e,t,s){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(s,n,function(t){return e[t]}.bind(null,n));return s},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var l=0;l<a.length;l++)t(a[l]);var d=c;r.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"56d7":function(e,t,s){"use strict";s.r(t);var n=s("2b0e"),i=function(){var e=this,t=e._self._c;return t("div",{class:{"dark-theme":e.isDarkTheme},attrs:{id:"app"}},[t("div",{staticClass:"app-layout"},[t("header",{staticClass:"app-header"},[t("div",{staticClass:"header-left"},[t("div",{staticClass:"logo"},[t("svg",{staticClass:"logo-icon",attrs:{viewBox:"0 0 24 24",fill:"none"}},[t("path",{attrs:{d:"M13 2L3 14h9l-1 8 10-12h-9l1-8z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})]),t("span",{staticClass:"logo-text"},[e._v("电子负载参数管理")])])]),t("div",{staticClass:"header-center"},[t("nav",{staticClass:"main-nav"},[t("router-link",{staticClass:"nav-item",attrs:{to:"/",exact:""}},[t("i",{staticClass:"el-icon-s-home"}),t("span",[e._v("首页")])]),t("router-link",{staticClass:"nav-item",attrs:{to:"/params"}},[t("i",{staticClass:"el-icon-setting"}),t("span",[e._v("参数编辑")])]),t("router-link",{staticClass:"nav-item",attrs:{to:"/files"}},[t("i",{staticClass:"el-icon-folder"}),t("span",[e._v("文件管理")])]),t("router-link",{staticClass:"nav-item",attrs:{to:"/device"}},[t("i",{staticClass:"el-icon-monitor"}),t("span",[e._v("设备连接")])])],1)]),t("div",{staticClass:"header-right"},[t("div",{staticClass:"device-status",class:{connected:e.deviceConnected}},[t("span",{staticClass:"status-dot"}),t("span",{staticClass:"status-text"},[e._v(e._s(e.deviceConnected?"设备已连接":"设备未连接"))])]),t("el-tooltip",{attrs:{content:"切换主题",placement:"bottom"}},[t("button",{staticClass:"theme-toggle",on:{click:e.toggleTheme}},[t("i",{class:e.isDarkTheme?"el-icon-sunny":"el-icon-moon"})])])],1)]),t("main",{staticClass:"app-main"},[t("transition",{attrs:{name:"fade-slide",mode:"out-in"}},[t("router-view")],1)],1),t("footer",{staticClass:"app-footer"},[t("div",{staticClass:"footer-left"},[t("span",{staticClass:"ws-status",class:{connected:e.wsConnected}},[t("span",{staticClass:"status-indicator"}),e._v(" "+e._s(e.wsConnected?"实时连接":"连接断开")+" ")])]),t("div",{staticClass:"footer-center"},[e.currentFile?t("span",{staticClass:"current-file"},[t("i",{staticClass:"el-icon-document"}),e._v(" "+e._s(e.currentFile)+" "),e.hasUnsavedChanges?t("span",{staticClass:"unsaved-badge"},[e._v("●")]):e._e()]):e._e()]),e._m(0)])])])},r=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"footer-right"},[t("span",{staticClass:"version"},[e._v("v1.0.0")])])}],o=s("2f62"),a={name:"App",computed:{...Object(o["b"])(["wsConnected","currentFile","hasUnsavedChanges"]),...Object(o["a"])(["deviceConnected"]),isDarkTheme(){return"dark"===this.$store.state.config.theme}},methods:{toggleTheme(){const e=this.isDarkTheme?"light":"dark";this.$store.commit("SET_CONFIG",{theme:e})}},mounted(){this.$store.dispatch("loadConfig")}},c=a,l=(s("f294"),s("2877")),d=Object(l["a"])(c,i,r,!1,null,null,null),u=d.exports,h=s("5c96"),p=s.n(h);s("0fae"),s("d9e2"),s("14d9"),s("e9f5"),s("7d54"),s("e9c4"),s("5087");class m{constructor(e=null){if(!e)if(window.WS_URL)e=window.WS_URL;else{const t="https:"===window.location.protocol?"wss:":"ws:",s=window.location.hostname;e=`${t}//${s}:28657/ws`}this.url=e,this.ws=null,this.connected=!1,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectInterval=3e3,this.topic="LOADER",this.messageId=0,this.pendingRequests=new Map,this.listeners=new Map,this.requestTimeout=1e4}connect(){return new Promise((e,t)=>{this.ws&&this.ws.readyState===WebSocket.OPEN?e():(console.log("[WS] Connecting: "+this.url),this.ws=new WebSocket(this.url),this.ws.onopen=()=>{console.log("[WS] Connected"),this.connected=!0,this.reconnectAttempts=0;try{this.ws.send("Hello, I am loader")}catch(t){console.warn("[WS] hello handshake failed:",t)}this.emit("connected"),e()},this.ws.onclose=e=>{console.log("[WS] Connection closed",e.code,e.reason),this.connected=!1,this.emit("disconnected"),this.tryReconnect()},this.ws.onerror=e=>{console.error("[WS] Connection error",e),this.emit("error",e),t(e)},this.ws.onmessage=e=>{this.handleMessage(e.data)})})}disconnect(){this.ws&&(this.ws.close(),this.ws=null),this.connected=!1}tryReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts)return console.log("[WS] Max reconnect attempts reached"),void this.emit("reconnectFailed");this.reconnectAttempts++,console.log(`[WS] Retrying (${this.reconnectAttempts}/${this.maxReconnectAttempts})...`),setTimeout(()=>{this.connect().catch(()=>{})},this.reconnectInterval)}handleMessage(e){try{if("string"!==typeof e)return;const s=JSON.parse(e);if(Array.isArray(s)){if(this.pendingRequests.size>0){let e=null;for(const s of this.pendingRequests.keys())(null===e||Number(s)>Number(e))&&(e=s);const t=null!==e?this.pendingRequests.get(e):null;if(t){const{resolve:n,timer:i}=t;return clearTimeout(i),this.pendingRequests.delete(e),void n({topic:this.topic,cmd_id:e,name:"anonymous.array",data:s})}}return void this.emit("anonymous.array",s)}const n=void 0!==s.cmd_id?s.cmd_id:s.id,i=void 0!==n&&null!==n?String(n):null;if(i&&this.pendingRequests.has(i)){const{resolve:e,reject:n,timer:r}=this.pendingRequests.get(i);clearTimeout(r),this.pendingRequests.delete(i);let o=s;if(void 0!==s.data)if("string"===typeof s.data)try{o=JSON.parse(s.data)}catch(t){o=s.data}else o=s.data;const a=!1!==o.success&&!1!==o.ok&&(void 0===o.code||0===o.code);return void(a||!1!==o.success?e(o):n(new Error(o.error||o.msg||o.desc||"Request failed")))}if(s&&s.name){let e=s.data;if("string"===typeof s.data&&(s.data.startsWith("{")||s.data.startsWith("[")))try{e=JSON.parse(s.data)}catch(t){}"refresh_signals"===s.name?this.emit("refresh_signals",e):this.emit(s.name,e)}}catch(s){console.error("[WS] Message parse failed:",s,"Raw data:",e)}}request(e,t={}){return new Promise((s,n)=>{if(!this.connected)return void n(new Error("WebSocket Not Connected"));const i=1e3*Date.now()+ ++this.messageId%1e3,r=String(i),o="string"===typeof t?t:JSON.stringify(t||{}),a={topic:this.topic,cmd_id:i,name:e,data:o},c=setTimeout(()=>{this.pendingRequests.delete(r),n(new Error("Request Timeout"))},this.requestTimeout);this.pendingRequests.set(r,{resolve:s,reject:n,timer:c}),console.log("[WS] Request:",e,t,"cmd_id=",i),this.ws.send(JSON.stringify(a))})}send(e,t={}){if(!this.connected)return console.warn("[WS] Not connected, cannot send"),!1;const s=1e3*Date.now()+ ++this.messageId%1e3,n="string"===typeof t?t:JSON.stringify(t||{});return this.ws.send(JSON.stringify({topic:this.topic,cmd_id:s,name:e,data:n})),!0}on(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)}off(e,t){if(this.listeners.has(e)){const s=this.listeners.get(e),n=s.indexOf(t);-1!==n&&s.splice(n,1)}}emit(e,t){this.listeners.has(e)&&this.listeners.get(e).forEach(e=>e(t))}startGetConnectStatus(){return this.request("start_get_connect_status",{})}stopAllTimers(){return this.request("stop_all_timers",{})}queryLocationInfo(){return this.request("query_location_info",{})}getModels(e,t,s="component_emulation"){return this.request("get_models",{device_id:e,loader_num:t,sim_type:s})}startLoader(e,t,s,n="component_emulation"){return this.request("start_loader",{device_id:e,loader_num:t,model:s,sim_type:n})}stopLoader(e,t,s,n="component_emulation"){return this.request("stop_loader",{device_id:e,loader_num:t,model:s,sim_type:n})}getSignals(e,t,s){const n=Array.isArray(s)?s:s?[s]:[];return this.request("get_signals",{device_id:e,loader_num:t,regs:n})}scheduleRefreshSignals(e,t,s,n){const i=Array.isArray(s)?s:s?[s]:[];return this.request("schedule_refresh_signals",{device_id:e,loader_num:t,regs:i,period:n})}stopRefreshRegs(){return this.request("stop_refresh_regs",{})}setRegValue(e,t,s,n){return this.request("set_reg_value",{device_id:e,loader_num:t,reg_name:s,reg_value:String(n)})}waitRegValue(e,t,s){return this.request("wait_reg_value",{device_id:e,loader_num:t,reg_name:s})}saveLocationInfo(e){return this.request("save_location_info",{location:e})}getLocalFileList(){return this.request("get_local_file_list",{})}readLocalFile(e){return this.request("read_local_file",{path:e})}saveLocalFile(e,t){return this.request("save_local_file",{path:e,content:t})}saveAsLocalFile(e,t){return this.request("save_as_local_file",{path:e,content:t})}uploadToCloud(e){return this.request("upload_to_cloud",{path:e})}downloadFromDevice(e,t,s,n){return this.request("download_from_device",{device_id:e,loader_num:t,device_path:s,local_path:n})}applyParamsToDevice(e,t,s,n){return this.request("apply_params_to_device",{device_id:e,loader_num:t,path:s,content:n})}deleteLocalFile(e){return this.request("delete_local_file",{path:e})}loaderOta(e,t,s){return this.request("loader_ota",{device_id:e,loader_num:t,path:s})}pullFile(e,t,s){return this.request("pull_file",{device_id:e,loader_num:t,path:s})}getFileInfo(e,t,s=""){return this.request("get_file_info",{device_id:e,loader_num:t,name:s})}checkLoadersNewVersion(){return this.request("check_loaders_new_version",{})}updateOneLoader(e,t){return this.request("update_one_loader",{device_id:e,loader_num:t})}loadModel(e,t,s,n,i=!1){const r=i?{modelzip:s,project:n,all_devices:!0}:{device_id:e,loader_num:t,modelzip:s,project:n,all_devices:!1};return this.request("load_model",r)}downloadCloudModels(e,t,s,n,i){return this.request("download_cloud_models",{device_id:e,loader_num:t,model_name:s,model_id:n,project:i})}sendCmd(e,t,s,n=!1){return this.request("send_cmd",{device_id:e,loader_num:t,cmd:s,multi_frames:n})}}var _=new m;n["default"].config.productionTip=!1,n["default"].use(p.a),n["default"].prototype.$socket=_,new n["default"]({render:e=>e(u)}).$mount("#app")},e53e:function(e,t,s){},f294:function(e,t,s){"use strict";s("e53e")}});