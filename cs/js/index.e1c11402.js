(function(e){function t(t){for(var n,a,i=t[0],c=t[1],l=t[2],u=0,d=[];u<i.length;u++)a=i[u],Object.prototype.hasOwnProperty.call(r,a)&&r[a]&&d.push(r[a][0]),r[a]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);h&&h(t);while(d.length)d.shift()();return o.push.apply(o,l||[]),s()}function s(){for(var e,t=0;t<o.length;t++){for(var s=o[t],n=!0,a=1;a<s.length;a++){var i=s[a];0!==r[i]&&(n=!1)}n&&(o.splice(t--,1),e=c(c.s=s[0]))}return e}var n={},a={index:0},r={index:0},o=[];function i(e){return c.p+"js/"+({}[e]||e)+"."+{"chunk-0e3c8099":"ab560fe7","chunk-297a144e":"3f086e74","chunk-771331e4":"8586b449","chunk-7e61c1c0":"6509915c"}[e]+".js"}function c(t){if(n[t])return n[t].exports;var s=n[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,c),s.l=!0,s.exports}c.e=function(e){var t=[],s={"chunk-0e3c8099":1,"chunk-297a144e":1,"chunk-771331e4":1,"chunk-7e61c1c0":1};a[e]?t.push(a[e]):0!==a[e]&&s[e]&&t.push(a[e]=new Promise((function(t,s){for(var n="css/"+({}[e]||e)+"."+{"chunk-0e3c8099":"d793f7e8","chunk-297a144e":"280b91eb","chunk-771331e4":"3ed62e30","chunk-7e61c1c0":"c7abf9da"}[e]+".css",r=c.p+n,o=document.getElementsByTagName("link"),i=0;i<o.length;i++){var l=o[i],u=l.getAttribute("data-href")||l.getAttribute("href");if("stylesheet"===l.rel&&(u===n||u===r))return t()}var d=document.getElementsByTagName("style");for(i=0;i<d.length;i++){l=d[i],u=l.getAttribute("data-href");if(u===n||u===r)return t()}var h=document.createElement("link");h.rel="stylesheet",h.type="text/css",h.onload=t,h.onerror=function(t){var n=t&&t.target&&t.target.src||r,o=new Error("Loading CSS chunk "+e+" failed.\n("+n+")");o.code="CSS_CHUNK_LOAD_FAILED",o.request=n,delete a[e],h.parentNode.removeChild(h),s(o)},h.href=r;var m=document.getElementsByTagName("head")[0];m.appendChild(h)})).then((function(){a[e]=0})));var n=r[e];if(0!==n)if(n)t.push(n[2]);else{var o=new Promise((function(t,s){n=r[e]=[t,s]}));t.push(n[2]=o);var l,u=document.createElement("script");u.charset="utf-8",u.timeout=120,c.nc&&u.setAttribute("nonce",c.nc),u.src=i(e);var d=new Error;l=function(t){u.onerror=u.onload=null,clearTimeout(h);var s=r[e];if(0!==s){if(s){var n=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;d.message="Loading chunk "+e+" failed.\n("+n+": "+a+")",d.name="ChunkLoadError",d.type=n,d.request=a,s[1](d)}r[e]=void 0}};var h=setTimeout((function(){l({type:"timeout",target:u})}),12e4);u.onerror=u.onload=l,document.head.appendChild(u)}return Promise.all(t)},c.m=e,c.c=n,c.d=function(e,t,s){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(c.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)c.d(s,n,function(t){return e[t]}.bind(null,n));return s},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="",c.oe=function(e){throw console.error(e),e};var l=window["webpackJsonp"]=window["webpackJsonp"]||[],u=l.push.bind(l);l.push=t,l=l.slice();for(var d=0;d<l.length;d++)t(l[d]);var h=u;o.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"33f6":function(e,t,s){},"365c":function(e,t,s){"use strict";var n=s("cee4");const a=n["a"].create({baseURL:"/api",timeout:3e4,headers:{"Content-Type":"application/json"}});a.interceptors.request.use(e=>e,e=>Promise.reject(e)),a.interceptors.response.use(e=>e,e=>(console.error("API请求错误:",e),Promise.reject(e)));const r={list(){return a.get("/bin/list")},read(e){return a.get("/bin/read/"+encodeURIComponent(e))},save(e,t){return a.post("/bin/save/"+encodeURIComponent(e),t)},upload(e){const t=new FormData;return t.append("binfile",e),a.post("/bin/upload",t,{headers:{"Content-Type":"multipart/form-data"}})},getSchema(){return a.get("/bin/schema")},getBackups(){return a.get("/bin/backups")},restore(e,t){return a.post("/bin/restore/"+encodeURIComponent(e),{targetName:t})}},o={status(){return a.get("/device/status")},connect(e,t){return a.post("/device/connect",{ip:e,port:t})},disconnect(){return a.post("/device/disconnect")},sync(e,t){return a.post("/device/sync",{filename:e,data:t})},readBin(){return a.get("/device/read-bin")},command(e,t){return a.post("/device/command",{command:e,params:t})},discover(e){return a.get("/device/discover",{params:{subnet:e}})}},i={get(){return a.get("/config")},update(e){return a.put("/config",e)},reset(){return a.post("/config/reset")},export(){return a.get("/config/export")},import(e){return a.post("/config/import",e)}};t["a"]={bin:r,device:o,config:i}},"56d7":function(e,t,s){"use strict";s.r(t);var n=s("2b0e"),a=function(){var e=this,t=e._self._c;return t("div",{class:{"dark-theme":e.isDarkTheme},attrs:{id:"app"}},[t("div",{staticClass:"app-layout"},[t("header",{staticClass:"app-header"},[t("div",{staticClass:"header-left"},[t("div",{staticClass:"logo"},[t("svg",{staticClass:"logo-icon",attrs:{viewBox:"0 0 24 24",fill:"none"}},[t("path",{attrs:{d:"M13 2L3 14h9l-1 8 10-12h-9l1-8z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})]),t("span",{staticClass:"logo-text"},[e._v("电子负载参数管理")])])]),t("div",{staticClass:"header-center"},[t("nav",{staticClass:"main-nav"},[t("router-link",{staticClass:"nav-item",attrs:{to:"/",exact:""}},[t("i",{staticClass:"el-icon-s-home"}),t("span",[e._v("首页")])]),t("router-link",{staticClass:"nav-item",attrs:{to:"/params"}},[t("i",{staticClass:"el-icon-setting"}),t("span",[e._v("参数编辑")])]),t("router-link",{staticClass:"nav-item",attrs:{to:"/files"}},[t("i",{staticClass:"el-icon-folder"}),t("span",[e._v("文件管理")])]),t("router-link",{staticClass:"nav-item",attrs:{to:"/device"}},[t("i",{staticClass:"el-icon-monitor"}),t("span",[e._v("设备连接")])])],1)]),t("div",{staticClass:"header-right"},[t("div",{staticClass:"device-status",class:{connected:e.deviceConnected}},[t("span",{staticClass:"status-dot"}),t("span",{staticClass:"status-text"},[e._v(e._s(e.deviceConnected?"设备已连接":"设备未连接"))])]),t("el-tooltip",{attrs:{content:"切换主题",placement:"bottom"}},[t("button",{staticClass:"theme-toggle",on:{click:e.toggleTheme}},[t("i",{class:e.isDarkTheme?"el-icon-sunny":"el-icon-moon"})])])],1)]),t("main",{staticClass:"app-main"},[t("transition",{attrs:{name:"fade-slide",mode:"out-in"}},[t("router-view")],1)],1),t("footer",{staticClass:"app-footer"},[t("div",{staticClass:"footer-left"},[t("span",{staticClass:"ws-status",class:{connected:e.wsConnected}},[t("span",{staticClass:"status-indicator"}),e._v(" "+e._s(e.wsConnected?"实时连接":"连接断开")+" ")])]),t("div",{staticClass:"footer-center"},[e.currentFile?t("span",{staticClass:"current-file"},[t("i",{staticClass:"el-icon-document"}),e._v(" "+e._s(e.currentFile)+" "),e.hasUnsavedChanges?t("span",{staticClass:"unsaved-badge"},[e._v("●")]):e._e()]):e._e()]),e._m(0)])])])},r=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"footer-right"},[t("span",{staticClass:"version"},[e._v("v1.0.0")])])}],o=s("2f62"),i={name:"App",computed:{...Object(o["c"])(["wsConnected","currentFile","hasUnsavedChanges"]),...Object(o["b"])(["deviceConnected"]),isDarkTheme(){return"dark"===this.$store.state.config.theme}},methods:{toggleTheme(){const e=this.isDarkTheme?"light":"dark";this.$store.commit("SET_CONFIG",{theme:e})}},mounted(){this.$store.dispatch("loadConfig")}},c=i,l=(s("f294"),s("2877")),u=Object(l["a"])(c,a,r,!1,null,null,null),d=u.exports,h=s("8c4f");n["default"].use(h["a"]);const m=[{path:"/",name:"Home",component:()=>s.e("chunk-0e3c8099").then(s.bind(null,"bb51")),meta:{title:"首页"}},{path:"/params",name:"ParamEditor",component:()=>s.e("chunk-771331e4").then(s.bind(null,"5e81")),meta:{title:"参数编辑"}},{path:"/files",name:"FileManager",component:()=>s.e("chunk-297a144e").then(s.bind(null,"ffef")),meta:{title:"文件管理"}},{path:"/device",name:"DeviceConnect",component:()=>s.e("chunk-7e61c1c0").then(s.bind(null,"0670")),meta:{title:"设备连接"}}],p=new h["a"]({mode:"history",base:"",routes:m});p.beforeEach((e,t,s)=>{document.title=(e.meta.title||"电子负载")+" - 参数管理系统",s()});var f=p,_=(s("14d9"),s("e9f5"),s("910d"),s("a732"),s("365c"));n["default"].use(o["a"]);var v=new o["a"].Store({state:{wsConnected:!1,device:{connected:!1,ip:"",port:0,info:null,lastHeartbeat:null},currentFile:null,params:{},paramSchema:null,hasUnsavedChanges:!1,fileList:[],backupList:[],config:{theme:"dark",autoSave:!0,autoSaveInterval:3e4,showAdvancedParams:!1},loading:{files:!1,params:!1,device:!1,sync:!1},notifications:[]},getters:{deviceConnected:e=>e.device.connected,currentParams:e=>e.params,paramGroups:e=>e.paramSchema&&e.paramSchema.groups||[],isLoading:e=>Object.values(e.loading).some(e=>e)},mutations:{SET_WS_CONNECTED(e,t){e.wsConnected=t},SET_DEVICE_STATUS(e,t){e.device={...e.device,...t}},SET_CURRENT_FILE(e,t){e.currentFile=t},SET_PARAMS(e,t){e.params=t,e.hasUnsavedChanges=!1},UPDATE_PARAM(e,{key:t,value:s}){const a=t.split(".");let r=e.params;for(let n=0;n<a.length-1;n++){const e=a[n],t=e.match(/(\w+)\[(\d+)\]/);r=t?r[t[1]][parseInt(t[2])]:r[e]}const o=a[a.length-1];n["default"].set(r,o,s),e.hasUnsavedChanges=!0},SET_PARAM_SCHEMA(e,t){e.paramSchema=t},SET_FILE_LIST(e,t){e.fileList=t},SET_BACKUP_LIST(e,t){e.backupList=t},SET_CONFIG(e,t){e.config={...e.config,...t}},SET_LOADING(e,{key:t,value:s}){e.loading[t]=s},SET_UNSAVED_CHANGES(e,t){e.hasUnsavedChanges=t},ADD_NOTIFICATION(e,t){e.notifications.push({id:Date.now(),...t})},REMOVE_NOTIFICATION(e,t){e.notifications=e.notifications.filter(e=>e.id!==t)}},actions:{handleWsMessage({commit:e,dispatch:t},s){switch(s.type){case"device_status":e("SET_DEVICE_STATUS",s.status);break;case"param_updated":t("loadParams",s.filename);break;case"notification":e("ADD_NOTIFICATION",s.notification);break}},async loadConfig({commit:e}){try{const{data:t}=await _["a"].config.get();t.success&&e("SET_CONFIG",t.config.app||{})}catch(t){console.error("加载配置失败",t)}},async saveConfig({state:e}){try{await _["a"].config.update({app:e.config})}catch(t){console.error("保存配置失败",t)}},async loadParamSchema({commit:e}){try{const{data:t}=await _["a"].bin.getSchema();t.success&&e("SET_PARAM_SCHEMA",t.schema)}catch(t){console.error("加载参数Schema失败",t)}},async loadFileList({commit:e}){e("SET_LOADING",{key:"files",value:!0});try{const{data:t}=await _["a"].bin.list();t.success&&e("SET_FILE_LIST",t.files)}catch(t){console.error("加载文件列表失败",t)}finally{e("SET_LOADING",{key:"files",value:!1})}},async loadBackupList({commit:e}){try{const{data:t}=await _["a"].bin.getBackups();t.success&&e("SET_BACKUP_LIST",t.backups)}catch(t){console.error("加载备份列表失败",t)}},async openFile({commit:e},t){e("SET_LOADING",{key:"params",value:!0});try{const{data:s}=await _["a"].bin.read(t);return s.success?(e("SET_CURRENT_FILE",t),e("SET_PARAMS",s.params),{success:!0}):{success:!1,error:s.error}}catch(s){return console.error("打开文件失败",s),{success:!1,error:s.message}}finally{e("SET_LOADING",{key:"params",value:!1})}},async saveParams({state:e,commit:t}){if(!e.currentFile)return{success:!1,error:"未选择文件"};t("SET_LOADING",{key:"params",value:!0});try{const{data:s}=await _["a"].bin.save(e.currentFile,{params:e.params,createBackup:!0});return s.success&&(t("SET_UNSAVED_CHANGES",!1),t("ADD_NOTIFICATION",{type:"success",message:"参数保存成功"})),s}catch(s){return console.error("保存参数失败",s),{success:!1,error:s.message}}finally{t("SET_LOADING",{key:"params",value:!1})}},async connectDevice({commit:e},{ip:t,port:s}){e("SET_LOADING",{key:"device",value:!0});try{const{data:n}=await _["a"].device.connect(t,s);return n.success&&e("SET_DEVICE_STATUS",{connected:!0,ip:t,port:s,info:n.deviceInfo,lastHeartbeat:new Date}),n}catch(n){return console.error("连接设备失败",n),{success:!1,error:n.message}}finally{e("SET_LOADING",{key:"device",value:!1})}},async disconnectDevice({commit:e}){try{return await _["a"].device.disconnect(),e("SET_DEVICE_STATUS",{connected:!1,ip:"",port:0,info:null,lastHeartbeat:null}),{success:!0}}catch(t){return console.error("断开设备失败",t),{success:!1,error:t.message}}},async syncToDevice({state:e,commit:t}){if(!e.device.connected)return{success:!1,error:"设备未连接"};t("SET_LOADING",{key:"sync",value:!0});try{const{data:s}=await _["a"].device.sync(e.currentFile,e.params);return s.success&&t("ADD_NOTIFICATION",{type:"success",message:"参数已同步到设备"}),s}catch(s){return console.error("同步到设备失败",s),{success:!1,error:s.message}}finally{t("SET_LOADING",{key:"sync",value:!1})}}}}),g=s("5c96"),y=s.n(g);s("0fae"),s("33f6"),s("d9e2"),s("7d54"),s("e9c4"),s("5087");class S{constructor(e=null){if(!e)if(window.WS_URL)e=window.WS_URL;else{const t="https:"===window.location.protocol?"wss:":"ws:",s=window.location.hostname;e=`${t}//${s}:28657/ws`}this.url=e,this.ws=null,this.connected=!1,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectInterval=3e3,this.topic="LOADER",this.messageId=0,this.pendingRequests=new Map,this.listeners=new Map,this.requestTimeout=1e4}connect(){return new Promise((e,t)=>{this.ws&&this.ws.readyState===WebSocket.OPEN?e():(console.log("[WS] 正在连接: "+this.url),this.ws=new WebSocket(this.url),this.ws.onopen=()=>{console.log("[WS] 连接成功"),this.connected=!0,this.reconnectAttempts=0;try{this.ws.send("Hello, I am ui")}catch(t){console.warn("[WS] hello handshake failed:",t)}this.emit("connected"),e()},this.ws.onclose=e=>{console.log("[WS] 连接关闭",e.code,e.reason),this.connected=!1,this.emit("disconnected"),this.tryReconnect()},this.ws.onerror=e=>{console.error("[WS] 连接错误",e),this.emit("error",e),t(e)},this.ws.onmessage=e=>{this.handleMessage(e.data)})})}disconnect(){this.ws&&(this.ws.close(),this.ws=null),this.connected=!1}tryReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts)return console.log("[WS] 达到最大重连次数，停止重连"),void this.emit("reconnectFailed");this.reconnectAttempts++,console.log(`[WS] 尝试重连 (${this.reconnectAttempts}/${this.maxReconnectAttempts})...`),setTimeout(()=>{this.connect().catch(()=>{})},this.reconnectInterval)}handleMessage(e){try{if("string"!==typeof e)return;const s=JSON.parse(e);if(Array.isArray(s)){if(this.pendingRequests.size>0){let e=null;for(const s of this.pendingRequests.keys())(null===e||Number(s)>Number(e))&&(e=s);const t=null!==e?this.pendingRequests.get(e):null;if(t){const{resolve:n,timer:a}=t;return clearTimeout(a),this.pendingRequests.delete(e),void n({topic:this.topic,cmd_id:e,name:"anonymous.array",data:s})}}return void this.emit("anonymous.array",s)}const n=void 0!==s.cmd_id?s.cmd_id:s.id,a=void 0!==n&&null!==n?String(n):null;if(a&&this.pendingRequests.has(a)){const{resolve:e,reject:n,timer:r}=this.pendingRequests.get(a);clearTimeout(r),this.pendingRequests.delete(a);let o=s;if(void 0!==s.data)if("string"===typeof s.data)try{o=JSON.parse(s.data)}catch(t){o=s.data}else o=s.data;const i=!1!==o.success&&!1!==o.ok&&(void 0===o.code||0===o.code);return void(i||!1!==o.success?e(o):n(new Error(o.error||o.msg||o.desc||"请求失败")))}if(s&&s.name){let e=s.data;if("string"===typeof s.data&&(s.data.startsWith("{")||s.data.startsWith("[")))try{e=JSON.parse(s.data)}catch(t){}"refresh_signals"===s.name?this.emit("refresh_signals",e):this.emit(s.name,e)}}catch(s){console.error("[WS] 消息解析失败:",s,"原始数据:",e)}}request(e,t={}){return new Promise((s,n)=>{if(!this.connected)return void n(new Error("WebSocket 未连接"));const a=1e3*Date.now()+ ++this.messageId%1e3,r=String(a),o="string"===typeof t?t:JSON.stringify(t||{}),i={topic:this.topic,cmd_id:a,name:e,data:o},c=setTimeout(()=>{this.pendingRequests.delete(r),n(new Error("请求超时"))},this.requestTimeout);this.pendingRequests.set(r,{resolve:s,reject:n,timer:c}),console.log("[WS] 发送请求:",e,t,"cmd_id=",a),this.ws.send(JSON.stringify(i))})}send(e,t={}){if(!this.connected)return console.warn("[WS] 未连接，无法发送"),!1;const s=1e3*Date.now()+ ++this.messageId%1e3,n="string"===typeof t?t:JSON.stringify(t||{});return this.ws.send(JSON.stringify({topic:this.topic,cmd_id:s,name:e,data:n})),!0}on(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)}off(e,t){if(this.listeners.has(e)){const s=this.listeners.get(e),n=s.indexOf(t);-1!==n&&s.splice(n,1)}}emit(e,t){this.listeners.has(e)&&this.listeners.get(e).forEach(e=>e(t))}startGetConnectStatus(){return this.request("start_get_connect_status",{})}stopAllTimers(){return this.request("stop_all_timers",{})}queryLocationInfo(){return this.request("query_location_info",{})}getModels(e,t,s="component_emulation"){return this.request("get_models",{device_id:e,loader_num:t,sim_type:s})}startLoader(e,t,s,n="component_emulation"){return this.request("start_loader",{device_id:e,loader_num:t,model:s,sim_type:n})}stopLoader(e,t,s,n="component_emulation"){return this.request("stop_loader",{device_id:e,loader_num:t,model:s,sim_type:n})}getSignals(e,t,s){const n=Array.isArray(s)?s:s?[s]:[];return this.request("get_signals",{device_id:e,loader_num:t,regs:n})}scheduleRefreshSignals(e,t,s,n){const a=Array.isArray(s)?s:s?[s]:[];return this.request("schedule_refresh_signals",{device_id:e,loader_num:t,regs:a,period:n})}stopRefreshRegs(){return this.request("stop_refresh_regs",{})}setRegValue(e,t,s,n){return this.request("set_reg_value",{device_id:e,loader_num:t,reg_name:s,reg_value:String(n)})}waitRegValue(e,t,s){return this.request("wait_reg_value",{device_id:e,loader_num:t,reg_name:s})}saveLocationInfo(e){return this.request("save_location_info",{location:e})}getLocalFileList(){return this.request("get_local_file_list",{})}readLocalFile(e){return this.request("read_local_file",{path:e})}saveLocalFile(e,t){return this.request("save_local_file",{path:e,content:t})}saveAsLocalFile(e,t){return this.request("save_as_local_file",{path:e,content:t})}uploadToCloud(e){return this.request("upload_to_cloud",{path:e})}downloadFromDevice(e,t,s,n){return this.request("download_from_device",{device_id:e,loader_num:t,device_path:s,local_path:n})}applyParamsToDevice(e,t,s,n){return this.request("apply_params_to_device",{device_id:e,loader_num:t,path:s,content:n})}deleteLocalFile(e){return this.request("delete_local_file",{path:e})}loaderOta(e,t,s){return this.request("loader_ota",{device_id:e,loader_num:t,path:s})}pullFile(e,t,s){return this.request("pull_file",{device_id:e,loader_num:t,path:s})}getFileInfo(e,t,s=""){return this.request("get_file_info",{device_id:e,loader_num:t,name:s})}checkLoadersNewVersion(){return this.request("check_loaders_new_version",{})}updateOneLoader(e,t){return this.request("update_one_loader",{device_id:e,loader_num:t})}loadModel(e,t,s,n,a=!1){const r=a?{modelzip:s,project:n,all_devices:!0}:{device_id:e,loader_num:t,modelzip:s,project:n,all_devices:!1};return this.request("load_model",r)}downloadCloudModels(e,t,s,n,a){return this.request("download_cloud_models",{device_id:e,loader_num:t,model_name:s,model_id:n,project:a})}sendCmd(e,t,s,n=!1){return this.request("send_cmd",{device_id:e,loader_num:t,cmd:s,multi_frames:n})}}var w=new S;n["default"].config.productionTip=!1,n["default"].use(y.a),n["default"].prototype.$socket=w;const C=async()=>{try{await w.connect(),console.log("[main] WebSocket connected successfully")}catch(e){console.error("[main] WebSocket connection failed:",e)}new n["default"]({router:f,store:v,render:e=>e(d)}).$mount("#app")};C()},e53e:function(e,t,s){},f294:function(e,t,s){"use strict";s("e53e")}});